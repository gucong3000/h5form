<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>src\h5form.el.js - h5form</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title="h5form"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.2.5</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/h5form.html">h5form</a></li>
            
                <li><a href="../classes/HTMLFormElement.html">HTMLFormElement</a></li>
            
                <li><a href="../classes/HTMLInputElement.html">HTMLInputElement</a></li>
            
                <li><a href="../classes/HTMLTextAreaElement.html">HTMLTextAreaElement</a></li>
            
                <li><a href="../classes/ValidityState.html">ValidityState</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: src\h5form.el.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/**
 * 高端浏览器原生对象，h5form提供polyfill
 * @class HTMLInputElement
 */

/**
 * @description autofocus 属性规定在页面加载时，域自动地获得焦点。如：&amp;lt;input type=&amp;quot;text&amp;quot; autofocus&amp;gt;
 * @property {Boolean} autofocus
 * @default false
 */

/**
 * @description 用在button和input节点上，来阻止提交时验证此节点。如：&amp;lt;input type=&quot;submit&quot; value=&quot;Do NOT Validate&quot; formnovalidate&amp;gt;
 * @property {Boolean} formNoValidate
 */

/**
 * @description 规定输入域所允许的最小值。适用于以下类型的 input 标签：date pickers、number 以及 range。
 * @property {Number|String} min
 * @default &quot;&quot;
 */

/**
 * @description 规定输入域所允许的最大值。适用于以下类型的 input 标签：date pickers、number 以及 range。
 * @property {Number|String} max
 * @default &quot;&quot;
 */

/**
 * @description 输入域规定合法的数字间隔（如果 step=&quot;3&quot;，则合法的数是 -3,0,3,6 等）。适用于以下类型的 input 标签：date pickers、number 以及 range。
 * @property {Number|String} step
 * @default &quot;&quot;
 */

/**
 * @description 正则表达式，用于验证 input 域。
 * @property {String} pattern
 * @default &quot;&quot;
 */

/**
 * @description placeholder 属性提供一种提示（hint），描述输入域所期待的值。适用于以下类型的 input 标签：text, search, url, telephone, email 以及 password。
 * @property {String} placeholder
 * @default &quot;&quot;
 */

/**
 * @description 规定必须在提交之前填写输入域（不能为空）。
 * @property {Boolean} required
 * @default false
 */

/**
 * @description willValidate 属性标识了这个DOM节点是否使用约束验证。对于可以提交的元素来说这个属性会被设置成 true 除非因为某些原因被禁止使用约束验证，例如有 disabled 属性时。
 * @property willValidate
 * @type {Boolean}
 * @default true
 * @readOnly
 */

/**
 * @description Dom节点的validity 属性会返回一个 ValidityState对象，它包含了一系列与节点相关的布尔属性的验证结果。
 * @property {ValidityState} validity
 * @readOnly
 */

/**
 * @description 浏览器为这个属性提供了一个默认的本地化信息。如果DOM节点不需要验证或者节点包含正确的内容，那么validationMessage会被设置为空字符串。
 * @property {String} validationMessage
 * @readOnly
 */

/**
 * @description 表单元素节点的checkValidity方法在元素包含正确内容的时候会返回 true。表单（form）节点的checkValidity方法会在其所有子节点都包含正确内容的时候返回true。另外，每次通过checkValidity方法验证表单元素正确性的时候且验证失败，出错节点的invalid事件会被触发。
 * @method checkValidity
 * @return {Boolean} 元素包含正确内容的时候会返回 true
 */

/**
 * @description setCustomValidity方法改变了validationMessage属性，也允许你添加自定义的验证规则。
 * @method setCustomValidity
 * @param {String} CustomValidityMessage 新的错误消息
 */

/**
 * @description 文本变化事件，用于替代keypress事件，以便解决中文输入不触发问题
 * @event input
 */

/**
 * @description 表单验证失败事件
 * @event invalid
 */

/**
 * @description 高端浏览器原生对象，h5form提供polyfill
 * @class HTMLFormElement
 */

/**
 * @description 当使用这个属性的时候，就表示表单所有的输入内容在提交时不需要验证了, 如：&amp;lt;form novalidate&amp;gt;&amp;lt;/form&amp;gt;
 * @property {Boolean} noValidate
 */

/**
 * @description 高端浏览器原生对象，h5form提供polyfill，方法、属性、事件请参考[HTMLInputElement](HTMLInputElement.html)
 * @see HTMLInputElement
 * @class HTMLTextAreaElement
 */

/**
 * @description ValidityState对象是通过表单域的 validity 属性获取的，该对象属性值均为布尔值。
 * @class ValidityState
 */

/**
 * @description 必填的表单元素的值为空。
 * 如果表单元素设置了required特性，则为必填项。如果必填项的值为空，就无法通过表单验证，valueMissing属性会返回true，否则返回false。
 * @property {Boolean} valueMissing
 */

/**
 * @description 输入值与type类型不匹配。
 * HTML 5新增的表单类型如email、number、url等，都包含一个原始的类型验证。如果用户输入的内容与表单类型不符合，则typeMismatch属性将返回true，否则返回false。
 * @property {Boolean} typeMismatch
 */

/**
 * @description 输入值与pattern特性的正则不匹配。
 * 表单元素可通过pattern特性设置正则表达式的验证模式。如果输入的内容不符合验证模式的规则，则patternMismatch属性将返回true，否则返回false。
 * @property {Boolean} patternMismatch
 */

/**
 * @description 输入的内容超过了表单元素的maxLength 特性限定的字符长度。
 * 表单元素可使用maxLength特性设置输入内容的最大长度。虽然在输入的时候会限制表单内容的长度，但在某种情况下，如通过程序设置，还是会超出最大长度限制。如果输入的内容超过了最大长度限制，则tooLong属性返回true，否则返回false。
 * @property {Boolean} tooLong
 */

/**
 * @description 输入的值小于min特性的值。
 * 一般用于填写数值的表单元素，都可能会使用min特性设置数值范围的最小值。如果输入的数值小于最小值，则rangeUnderflow属性返回true，否则返回false。
 * @property {Boolean} rangeUnderflow
 */

/**
 * @description 输入的值大于max特性的值。
 * 一般用于填写数值的表单元素，也可能会使用max特性设置数值范围的最大值。如果输入的数值大于最大值，则rangeOverflow属性返回true，否则返回false。
 * @property {Boolean} rangeOverflow
 */

/**
 * @description 输入的值不符合step特性所推算出的规则。
 * 用于填写数值的表单元素，可能需要同时设置min、max和step特性，这就限制了输入的值必须是最小值与step特性值的倍数之和。如范围从0到10，step特性值为2，因为合法值为该范围内的偶数，其他数值均无法通过验证。如果输入值不符合要求，则stepMismatch属性返回true，否则返回false。
 * @property {Boolean} stepMismatch
 */

/**
 * @description 使用自定义的验证错误提示信息。
 * 有时候，不太适合使用浏览器内置的验证错误提示信息，需要自己定义。当输入值不符合语义规则时，会提示自定义的错误提示信息。
 * 通常使用setCustomValidity()方法自定义错误提示信息：setCustomValidity(message)会把错误提示信息自定义为message，此时customError属性值为true；setCustomValidity(&quot;&quot;)会清除自定义的错误信息，此时customError属性值为false。
 * @property {Boolean} customError
 */

(function(window, document) {
	&quot;use strict&quot;;

	var	strDOMContentLoaded = &quot;DOMContentLoaded&quot;,
		strInput = &quot;input&quot;,
		strPrototype = &quot;prototype&quot;,
		HTMLFormElementPrototype = getPrototype(HTMLFormElement),
		documentMode = document.documentMode,
		enumerable = !documentMode || document.documentMode &gt; 8,
		setTimeout = window.setTimeout,
		num = window.parseFloat,
		regexpTypes = {
			email: /^[a-zA-Z0-9.!#$%&amp;&#x27;*+-\/=?\^_&#x60;{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/,
			number: /^[+-]?\d+(\.\d+)?$/,
			url: /[a-z][\-\.+a-z]*:\/\//i,
			color: /#[\da-f]{6}/i
		},
		typeErrors = {
			email: &quot;请输入电子邮件地址。&quot;,
			number: &quot;请输入一个数字。&quot;,
			color: &quot;请输入一个颜色值&quot;,
			url: &quot;请输入一个URL。&quot;
		},
		jQuery = window.jQuery,
		validityCache = {},
		customCache = {},
		valueCache = {},
		support;

	try {
		document.querySelector(&quot;:invalid&quot;);
		support = true;
	} catch (ex) {

	}

	function ValidityObj() {

	}

	ValidityObj[strPrototype] = {
		patternMismatch: false,
		rangeUnderflow: false,
		rangeOverflow: false,
		stepMismatch: false,
		typeMismatch: false,
		valueMissing: false,
		customError: false,
		tooLong: false,
		valid: true
	};

	//document.createElement缩写
	function createElement(tag) {
		return document.createElement(tag);
	}

	function defineProperty(obj, name, descriptor) {
		descriptor.enumerable = enumerable;
		Object.defineProperty(obj, name, descriptor);
	}

	function defineGetter(obj, props) {
		for (var pName in props) {
			defineProperty(obj, pName, {
				get: props[pName]
			});
		}
	}

	function getPrototype(obj) {
		return obj[strPrototype] || obj;
	}

	function getElemType(elem) {
		return (elem.getAttribute(&quot;type&quot;, 2) || elem.type).toLowerCase();
	}

	function defineAttr(Element, prop) {
		if (!support) {
			Element = getPrototype(Element);
			forEach(prop, function(aName) {
				if (!(aName in Element)) {
					defineProperty(Element, aName, prop[aName] ? {
						get: function() {
							return this.getAttribute(aName, 2) || &quot;&quot;;
						},
						set: function(val) {
							this.setAttribute(aName, val);
						}
					} : {
						get: function() {
							return !!(this.attributes[aName]);
						},
						set: function(val) {
							if (val) {
								this.setAttribute(aName, aName);
							} else {
								this.removeAttribute(aName);
							}
						}
					});
				}
			});
		}
		return Element;
	}

	function stepMismatchMsg(elem) {
		var	val = num(elem.value),
			step = num(elem.step),
			deff = (val - num(elem.min) || (num(elem.max) - val)) % step,
			min = val - deff,
			max = min + step;
		return &quot;值应该为 &quot; + min + &quot; 或 &quot; + max;
	}

	function fixInputElement(Element) {
		Element = defineAttr(Element, {
			required: 0,
			pattern: 1
		});
		defineGetter(Element, {
			validity: function() {
				var elem = this,
					validity = validityCache[elem.uniqueID],
					validityGetter;

				function willValidate() {
					return elem.willValidate;
				}

				function hasVal() {
					return willValidate() &amp;&amp; !!elem.value;
				}

				function getType() {
					return getElemType(elem);
				}

				function isNum() {
					return hasVal() &amp;&amp; /^number|range$/i.test(getType());
				}

				if (!validity) {
					validity = new ValidityObj();

					validityGetter = {
						patternMismatch: function() {
							return hasVal() &amp;&amp; !!elem.pattern &amp;&amp; !new RegExp(&quot;^(?:&quot; + elem.pattern + &quot;)$&quot;).test(elem.value);
						},
						rangeUnderflow: function() {
							return isNum() &amp;&amp; num(elem.value) &lt; num(elem.min);
						},
						rangeOverflow: function() {
							return isNum() &amp;&amp; num(elem.value) &gt; num(elem.max);
						},
						stepMismatch: function() {
							return isNum() &amp;&amp; elem.step &amp;&amp; ((num(elem.value) - num(elem.min) || (num(elem.max) - num(elem.value))) % num(elem.step)) !== 0;
						},
						typeMismatch: function() {
							var regexp = regexpTypes[getType()];
							return hasVal() &amp;&amp; regexp &amp;&amp; !regexp.test(elem.value);
						},
						valueMissing: function() {
							return willValidate() &amp;&amp; elem.required &amp;&amp; !(/^checkbox$/i.test(elem.type) ? elem.checked : (/^radio$/i.test(elem.type) ? (elem.form || document).querySelector(&quot;[name=&#x27;&quot; + elem.name + &quot;&#x27;]:checked&quot;) : elem.value));
						},
						customError: function() {
							return !!customCache[elem.uniqueID];
						},
						badInput: function() {
							return false;
						},
						tooLong: function() {
							elem.value &amp;&amp; elem.value.length &gt; elem.maxLength;
						},
						valid: function() {
							var validityObj = elem.validity;
							return !(validityObj.tooLong || validityObj.customError || validityObj.valueMissing || validityObj.patternMismatch || validityObj.typeMismatch || validityObj.rangeOverflow || validityObj.rangeUnderflow || validityObj.stepMismatch);
						}
					};
					try {
						defineGetter(validity, validityGetter);
					} catch (ex) {
						validity = createElement(&quot;ValidityState&quot;);
						defineGetter(validity, validityGetter);
					}
					validityCache[elem.uniqueID] = validity;
				}
				return validity;
			},
			willValidate: function() {
				var elem = this;
				return !elem.disabled &amp;&amp; !(/^input$/i.test(elem.nodeName) &amp;&amp; /^hidden$/i.test(elem.type));
			},
			validationMessage: function() {
				var validityObj = this.validity;
				return customCache[this.uniqueID] || (validityObj.valueMissing ? &quot;请填写此字段。&quot; : (validityObj.patternMismatch ? &quot;请匹配要求的格式。&quot; : (validityObj.typeMismatch ? typeErrors[getElemType(this)] : (validityObj.rangeOverflow ? &quot;值必须小于或等于 &quot; + this.max : (validityObj.rangeUnderflow ? &quot;值必须大于或等于 &quot; + this.min : (validityObj.stepMismatch ? stepMismatchMsg(this) : &quot;&quot;))))));
			},
			setCustomValidity: function() {
				var uniqueID = this.uniqueID;
				return function(val) {
					customCache[uniqueID] = val;
				};
			}
		});

		defineGetter(Element, {
			checkValidity: function() {
				var node = this;
				return function() {
					var valid = node.validity.valid;
					if (!valid) {
						triggerEvent(node, &quot;invalid&quot;);
					}
					return valid;
				};
			}
		});

	}

	function forEach(array, fn) {
		if (array) {
			var i;
			if (&quot;length&quot; in array) {
				for (i = 0; i &lt; array.length; i++) {
					if (fn(array[i]) === false) {
						return;
					}
				}
			} else {
				for (i in array) {
					if (fn(i) === false) {
						return;
					}
				}
			}
		}
	}

	function selector(strSelector, fn) {
		forEach(document.querySelectorAll(strSelector), fn);
	}

	//事件绑定
	function addEventListener(node, type, listener, useCapture) {
		if (enumerable) {
			node.addEventListener(type, listener, !!useCapture);
		} else if (strDOMContentLoaded === type) {
			if (jQuery) {
				jQuery(listener);
			} else {
				window.attachEvent(&quot;load&quot;, listener);
			}
		} else {
			if (jQuery &amp;&amp; type === strInput) {
				jQuery(node).bind(type + &quot;.h5form&quot;, listener);
			} else {
				node.attachEvent(&quot;on&quot; + type, function() {
					var	e = {},
						src = event;
					e.target = src.srcElement;
					e.defaultPrevented = src.returnValue === false;
					e.preventDefault = function() {
						e.defaultPrevented = true;
						src.returnValue = false;
					};
					listener.call(node, e);
				});
			}
		}
	}

	//事件触发
	function triggerEvent(node, type, cancelBubble) {
		if (document.createEvent) {
			var e = document.createEvent(&quot;HTMLEvents&quot;);
			e.initEvent(type, !!cancelBubble, true);
			node.dispatchEvent(e);
		} else if (jQuery) {
			jQuery(node).trigger(type);
		}
	}

	//对象值发生变化则触发一次input事件
	function checkValChange(e) {
		var target = e ? e.target : document.activeElement;
		if (isContentEditable(target) || isTextbox(target)) {
			setTimeout(function() {
				if (valueCache[target.uniqueID] !== getText(target)) {
					triggerEvent(target, strInput, true);
				}
			}, 0);
		}
	}

	//返回对象contentEditable属性值
	function isContentEditable(node) {
		return node.contentEditable;
	}

	//获取文本框的内容
	function getText(textbox) {
		return isContentEditable(textbox) ? textbox.innerHTML : textbox.value;
	}

	//判断对象是否文本框
	function isTextbox(node) {
		return /^text(area)?|password|email|search|tel|url$/i.test(node.type);
	}

	function documentready() {

		setTimeout(function() {
			if (support) {
				//重新定义表单提交行为避免IE原生表单验证bug导致该提交时不提交，或不该提交时提交了
				addEventListener(window, &quot;click&quot;, function(e) {
					var	target = e.target,
						form = target.form;

					if (!e.defaultPrevented &amp;&amp; e.which === 1 &amp;&amp; target &amp;&amp; form &amp;&amp; /^submit$/i.test(target.type) &amp;&amp; !(target.formNoValidate || form.noValidate)) {
						if (form.checkValidity()) {
							if (jQuery) {
								// 直接调用form.submit()会导致别处e.preventDefault()无效
								jQuery(form).submit();
							} else {
								form.submit();
							}
						} else {
							e.preventDefault();
							forEach(form.elements, function(node) {
								if (node.validity &amp;&amp; !node.validity.valid &amp;&amp; node.focus) {
									node.focus();
									return false;
								}
							});
						}
					}
				});
			} else {
				//修复autofocus
				selector(&quot;[autofocus]&quot;, function(input) {
					input.focus();
					return false;
				});
			}
		}, 250);
		if (enumerable) {
			//清除注册的事件监听函数
			document.removeEventListener(strDOMContentLoaded, documentready, false);
		}
	}

	/* 修正以下问题
	 * Input事件在IE9下的bug，详见http://blog.csdn.net/cuixiping/article/details/7450542
	 * IE9以上有contenteditable属性的元素没有input事件
	 * IE9以下，完全没有input事件
	 */
	forEach([strInput, &quot;focusin&quot;], function(eType) {
		addEventListener(window, eType, function(e) {
			var target = e.target;
			valueCache[target.uniqueID] = getText(target);
		}, true);
	});

	forEach(&quot;change cut keypress focusout propertychange&quot;.split(/\s/), function(eType) {
		addEventListener(window, eType, checkValChange, true);
	});

	if (enumerable) {
		setInterval(checkValChange, 200);
	}

	if (!support) {

		defineAttr(HTMLFormElementPrototype, {
			noValidate: 0
		});

		defineAttr(HTMLButtonElement, {
			formNoValidate: 0
		});

		defineAttr(HTMLInputElement, {
			formNoValidate: 0,
			placeholder: 1,
			step: 1,
			max: 1,
			min: 1
		});

		defineAttr(HTMLTextAreaElement, {
			placeholder: 1
		});

	}

	window.ValidityState = ValidityObj;

	defineGetter(HTMLFormElementPrototype, {
		checkValidity: function() {
			var form = this;
			return function() {
				var	valid = true,
					nodes = form.elements,
					node,
					i;
				for (i = 0; i &lt; nodes.length; i++) {
					node = nodes[i];
					if (node.checkValidity &amp;&amp; !node.disabled) {
						valid &amp;= node.checkValidity();
					}
				}
				return valid;
			};
		}
	});

	fixInputElement(HTMLTextAreaElement);
	fixInputElement(HTMLSelectElement);
	fixInputElement(HTMLButtonElement);
	fixInputElement(HTMLInputElement);

	//让IE9支持autofocus属性、干掉原生的气泡提示、修复某些浏览不会阻止表单提交的问题
	if (/^interactive|complete$/.test(document.readyState)) {
		documentready();
	} else {
		addEventListener(document, strDOMContentLoaded, documentready);
	}

})(this, document);
    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
